---
layout: post
title: Malware Analysis - Dexter Banker
categories: Recherches
---

![Intro-picture](/img/dexter/intro.PNG){:class="img-responsive"}

### 0. Sommaire

* 1. Introduction
* 2. Reconnaissance
* 3. Analyse
  * A) Mutex
  * B) Injection sous iexplorer.exe
  * C) Persistance
  * D) Options de sécurité IE
  * E) Keylogger SecureDLL.dll
  * F) Memory harvester
  * G) Serveur de contrôle
* 4. Indicateurs d'infection

### 1. Introduction
Le sample analysé est le suivant:
> 140d24af0c2b3a18529df12dfbc5f6de

Celui-ci est téléchargeable sur la plateforme [Malshare](https://malshare.com/sample.php?action=detail&hash=140d24af0c2b3a18529df12dfbc5f6de)
_Attention, bien que le sample ne soit pas tout jeune, celui-ci reste très agressif et capable de causer des dégats à votre machine ou à vos données. Merci d'uniquement ouvrir le fichier dans un environnement contrôlé._

### 2. Reconnaissance
• Le scan VirusTotal du fichier confirme dans un premier temps le caractère malicieux du fichier :
![picture](/img/dexter/A.PNG){:class="img-responsive"}
En croisant les appellations données par les différents antivirus du marché, il semblerait que le malware appartienne à la famille “Dexter” ou “Poxters”.
Il s’agit dans les deux cas d’un [banker/POS](https://en.wikipedia.org/wiki/Dexter_(malware)). L’analyse complète du binaire permettra de le catégoriser correctement par la suite.

• Au vu des différentes chaines de caractères observables dans l'exécutable, celui-ci ne semble pas packé.
L'utilitaire DIE ne détecte pas de signature de packers connus, et confirme le fait que le fichier soit bien l'actuel charge utile.
En revanche, le graphe d'entropie met en évidence le fait qu'une des sections du fichier posède une entropie particulièrement élevée:
![picture](/img/dexter/B.PNG){:class="img-responsive"}
Pour déterminer la source de cet entropie anormalement élevée dans un fichier brute, l'ouverture du fichier dans un éditeur héxadécimal permet de voir qu'un préfixe PE est présent au sein du fichier, mais que celui-ci semble obfusqué ou chiffré d'une certaine manière:
![picture](/img/dexter/C.PNG){:class="img-responsive"}
Le malware risque donc d'extraire un autre exécutable de lui-même à un certain moment.

• Dans un second temps, la liste des imports permet d’observer les fonctionnalités globales du malware sans rentrer dans le détail du fonctionnement de celui-ci.
La présence de nombreuses fonctions de manipulation mémoire (_OpenProcess_, _CreateRemoteThread_, _VirtualAlloc_ ou encore _HeapAlloc_) pourraient être le signe d’une injection en mémoire ou d’une manipulation de processus.
Au travers de la bibliothèque _WININET.dll_ et _URLMON.dll_ et via les fonctions _HttpSendRequest_, _InternetOpen_, _InternetGetCookie_, _InternetOpenUrl_ ou encore _InternetReadFile_ et _ObtainUserAgentString_, le malware va pouvoir interagir avec un serveur distant, télécharger des ressources additionnelles, ou même interroger les navigateurs internet de la machine infectée.
Outre les manipulations de clés de registre ou de fichiers sur le système, cette liste reste non-exhaustive, et permet unqiuement d’anticiper le comportement du binaire avant de l'analyser proprement.

• Pour terminer cette première phase de reconnaissance, les chaînes de caractères du binaire sont extraites. Puisque celles-ci ne sont pas obfusqués, et en les couplant avec les imports, de précieuses informations peuvent être extraites.
  ‣ La présence du chemin vers la clé de registre _“Software\Microsoft\Windows\CurrentVersion\Run”_ met potentiellement en évidence une technique de persistance adoptée par le malware.
  ‣ L’adresse IP _151.248.115.107_ et l’URL _/w19218317418621031041543/gateway.php_ pourraient servir de serveur de contrôle pour le malware, ou d’un point de téléchargement de composants additionnels.
  ‣ Un header HTTP est présent :
  > Mozilla/4.0(compatible; MSIE 7.0b; Windows NT 6.0)
  > POST
  > Content-Type:application/x-www-form-urlencoded

  Ceci confirme bien le fait que le malware va communiquer avec l'extérieur à un certain moment.
  ‣ Enfin de nombreuses références à une application Java sont faites, mêmes si elles n’ont aucune signification pour le moment :
  > Java Security Plugin
  > %s\\%s
  > javaplugin
  > Java Security Plugin
  > %s\\%s\\%s.exe
  > Sun Java Security Plugin

### 3. Analyse
#### A) Mutex
#### B) Injection sous iexplorer.exe
#### C) Persistance
#### D) Options de sécurité IE
#### E) Keylogger SecureDLL.dll
#### F) Memory harvester
#### G) Serveur de contrôle
### 4. Indicateurs d'infection
