---
layout: post
title: Malware Analysis - RogueRobin
categories: MalwareAnalysis
---
![Intro-picture](/img/DarkHydrus/darkhydrus_banner.jpg){:class="img-responsive"}

### Sommaire

* Introduction
* Reconnaissance
* DarkHydrus APT
* Analysis
  * A) Anti-VM et anti-debug
  * B) Méthodes de persistance
  * C) Exfiltration d’informations
    * 1) Principe de l’exfiltration DNS
    * 2) Exfiltration
  * D) Récolte d’informations systèmes
  * E) C2 Instruction handler
* Indicators of compromise

### Introduction
Le sample analysé possède le hash suivant:
> 2f22d521a1945d02380057a636e1032b

Le sample est téléchargeable sur [VirusBay](https://beta.virusbay.io/sample/browse/2f22d521a1945d02380057a636e1032b).

_Disclaimer habituel: le sample est en théorie inoffensif puisque les serveurs de contrôles n’existent plus, et que le malware n’a pas de potentiel destructeur sur un système infecté, mais une grande prudence reste recommandée lors de la manipulation du fichier._

### Reconnaissance
Le sample reste encore assez discret, sachant que celui-ci date déjà de plusieurs mois à l’heure de l’écriture du présent article:
![picture](/img/DarkHydrus/0.PNG){:class="img-responsive"}

Mention spéciale pour les antivirus ClamAV, Microsoft-Defender et Ikarus qui ont tous trois détectés précisément le malware:
![picture](/img/DarkHydrus/01.PNG){:class="img-responsive"}
![picture](/img/DarkHydrus/02.PNG){:class="img-responsive"}
![picture](/img/DarkHydrus/03.PNG){:class="img-responsive"}

Le binaire ne semble pas packé au vu de l’entropie du fichier:
![picture](/img/DarkHydrus/B.PNG){:class="img-responsive"}

Point positif pour l’analyse, le malware a été écrit en dans un langage .Net (dans le cas présent en C#):
![picture](/img/icedid/A.PNG){:class="img-responsive"}
L’avantage d’un malware écrit dans un langage .Net réside dans le fait que ce langage n’est pas compilé, et peut donc être facilement être reverse. Il est possible de retrouver le code source original du programme.

Enfin, le malware n’est ni packé ni obfusqué, ce qui fait que les chaînes de caractères du binaire sont visibles en clair. Ces chaînes permettent de grignoter quelques informations sur les fonctionnalités du malware avant d’entamer l’analyse, mais rien de bien important ou de décisif dans le cas présent.
